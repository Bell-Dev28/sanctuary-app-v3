(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{27:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i,w:()=>a});var s=r(2109),n=r.n(s);let l="qKrA!A24Fn2Vd9s";if(!l)throw Error("Missing NEXT_PUBLIC_APP_ENCRYPTION in .env.local – used for client-side AES encryption");function a(e){return n().AES.encrypt(e,l).toString()}function i(e){return n().AES.decrypt(e,l).toString(n().enc.Utf8)}},477:()=>{},2452:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var s=r(5155),n=r(2115),l=r(5695),a=r(9576),i=r(6874),o=r.n(i),c=r(9314);let u=e=>{let{topicId:t}=e,[r,l]=(0,n.useState)([]);return(0,n.useEffect)(()=>{(0,c.K)(t).then(l).catch(console.error)},[t]),(0,s.jsxs)("aside",{className:"w-full p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"History"}),(0,s.jsx)("ul",{className:"space-y-1",children:r.map(e=>(0,s.jsx)("li",{children:(0,s.jsx)(o(),{href:"/studio/".concat(t,"?entry=").concat(e.id),className:"text-blue-600 hover:underline text-sm",children:new Date(e.created_at).toLocaleString()})},e.id))})]})};var d=r(6671);function h(e){let{topicId:t}=e,[r,l]=(0,n.useState)([]),[a,i]=(0,n.useState)(""),[o,c]=(0,n.useState)(!1),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null==(e=u.current)||e.scrollTo({top:u.current.scrollHeight})},[r]);let h=async e=>{e.preventDefault();let s=a.trim();if(!s)return;let n={id:Date.now(),role:"user",content:s};l(e=>[...e,n]),i(""),c(!0);try{var o,u;let e=await fetch("/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t,messages:[...r,n]})}),s=await e.json();if(!e.ok)throw Error(s.error||"AI request failed");let a=null!=(u=null!=(o=s.text)?o:s.generated_text)?u:"",i={id:Date.now()+1,role:"assistant",content:a};l(e=>[...e,i])}catch(t){let e=t instanceof Error?t.message:"Unknown AI error";d.o.error(e)}finally{c(!1)}};return(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{ref:u,className:"flex-1 overflow-y-auto p-4 space-y-4",children:r.map(e=>(0,s.jsx)("div",{className:"max-w-lg px-3 py-2 rounded ".concat("user"===e.role?"self-end bg-blue-100 text-blue-900":"self-start bg-gray-100 text-gray-900"),children:e.content},e.id))}),(0,s.jsxs)("form",{onSubmit:h,className:"border-t p-4 flex space-x-2",children:[(0,s.jsx)("input",{type:"text",value:a,onChange:e=>i(e.target.value),disabled:o,placeholder:"Type your message…",className:"flex-1 border border-gray-300 rounded px-2 py-1"}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"bg-green-600 text-white px-4 py-1 rounded disabled:opacity-50",children:o?"…":"Send"})]})]})}function f(){let{user:e}=(0,a.A)(),t=(0,l.useRouter)(),r=(0,l.useParams)().journalTitle,i=Array.isArray(r)?r[0]:null!=r?r:"";return((0,n.useEffect)(()=>{e||t.replace("/login")},[e,t]),(0,n.useEffect)(()=>{r||t.replace("/")},[r,t]),e&&r)?(0,s.jsxs)("div",{className:"flex h-full",children:[(0,s.jsx)("aside",{className:"w-64 border-r",children:(0,s.jsx)(u,{topicId:i})}),(0,s.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,s.jsx)("header",{className:"p-4 border-b",children:(0,s.jsxs)("h1",{className:"text-xl font-semibold",children:["Studio: ",i]})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(h,{topicId:i})})]})]}):null}},6295:(e,t,r)=>{Promise.resolve().then(r.bind(r,2452))},6927:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});var s=r(5647);let n="https://cxqtrnpjshdwqtmsislw.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4cXRybnBqc2hkd3F0bXNpc2x3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTMwMDgsImV4cCI6MjA2NzM2OTAwOH0.snTMt7cMZHOdKjWMXU-TVARSp6z7wRrCGN8bVXnmAJI";if(!n||!l)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON in .env.local");let a=(0,s.UU)(n,l,{auth:{persistSession:!0,autoRefreshToken:!0}})},9314:(e,t,r)=>{"use strict";r.d(t,{K:()=>a,R:()=>l});var s=r(6927),n=r(27);async function l(e,t){let r=(0,n.w)(t),{data:l,error:a}=await s.N.from("journal_entries").insert({topic_id:e,content:r}).select("*").single();if(a)throw a;if(!l)throw Error("Failed to insert journal entry.");return{...l,content:(0,n.Y)(l.content)}}async function a(e){let{data:t,error:r}=await s.N.from("journal_entries").select("*").eq("topic_id",e).order("created_at",{ascending:!0});if(r)throw r;return(null!=t?t:[]).map(e=>({...e,content:(0,n.Y)(e.content)}))}},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>i});var s=r(5155),n=r(2115),l=r(6927);let a=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(null);(0,n.useEffect)(()=>{l.N.auth.getSession().then(e=>{var t,r;let{data:s}=e;i(s.session),c(null!=(r=null==(t=s.session)?void 0:t.user)?r:null)});let{data:e}=l.N.auth.onAuthStateChange((e,t)=>{var r;i(t),c(null!=(r=null==t?void 0:t.user)?r:null)});return()=>{e.subscription.unsubscribe()}},[]);let u=async(e,t)=>{let{error:r}=await l.N.auth.signInWithPassword({email:e,password:t});if(r)throw r},d=async()=>{await l.N.auth.signOut(),i(null),c(null)};return(0,s.jsx)(a.Provider,{value:{user:o,session:r,signInWithEmail:u,signOut:d},children:t})}function o(){let e=(0,n.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[825,671,874,109,441,684,358],()=>t(6295)),_N_E=e.O()}]);