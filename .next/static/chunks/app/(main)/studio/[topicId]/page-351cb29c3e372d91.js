(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{477:()=>{},2026:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var s=r(5155),l=r(2115),n=r(5695),a=r(9576),i=r(6874),o=r.n(i),c=r(6927),u=r(2109),d=r.n(u);let h="qKrA!A24Fn2Vd9s";if(!h)throw Error("Missing NEXT_PUBLIC_APP_ENCRYPTION in .env.local – used for client-side AES encryption");async function f(e){let{data:t,error:r}=await c.N.from("journal_entries").select("*").eq("topic_id",e).order("created_at",{ascending:!0});if(r)throw r;return(null!=t?t:[]).map(e=>{var t;return{...e,content:(t=e.content,d().AES.decrypt(t,h).toString(d().enc.Utf8))}})}let x=e=>{let{topicId:t}=e,[r,n]=(0,l.useState)([]);return(0,l.useEffect)(()=>{f(t).then(n).catch(console.error)},[t]),(0,s.jsxs)("aside",{className:"w-full p-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"History"}),(0,s.jsx)("ul",{className:"space-y-1",children:r.map(e=>(0,s.jsx)("li",{children:(0,s.jsx)(o(),{href:"/studio/".concat(t,"?entry=").concat(e.id),className:"text-blue-600 hover:underline text-sm",children:new Date(e.created_at).toLocaleString()})},e.id))})]})};var p=r(6671);function m(e){let{topicId:t}=e,[r,n]=(0,l.useState)([]),[a,i]=(0,l.useState)(""),[o,c]=(0,l.useState)(!1),u=(0,l.useRef)(null);(0,l.useEffect)(()=>{var e;null==(e=u.current)||e.scrollTo({top:u.current.scrollHeight})},[r]);let d=async e=>{e.preventDefault();let s=a.trim();if(!s)return;let l={id:Date.now(),role:"user",content:s};n(e=>[...e,l]),i(""),c(!0);try{var o,u;let e=await fetch("/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t,messages:[...r,l]})}),s=await e.json();if(!e.ok)throw Error(s.error||"AI request failed");let a=null!=(u=null!=(o=s.text)?o:s.generated_text)?u:"",i={id:Date.now()+1,role:"assistant",content:a};n(e=>[...e,i])}catch(t){let e=t instanceof Error?t.message:"Unknown AI error";p.oR.error(e)}finally{c(!1)}};return(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{ref:u,className:"flex-1 overflow-y-auto p-4 space-y-4",children:r.map(e=>(0,s.jsx)("div",{className:"max-w-lg px-3 py-2 rounded ".concat("user"===e.role?"self-end bg-blue-100 text-blue-900":"self-start bg-gray-100 text-gray-900"),children:e.content},e.id))}),(0,s.jsxs)("form",{onSubmit:d,className:"border-t p-4 flex space-x-2",children:[(0,s.jsx)("input",{type:"text",value:a,onChange:e=>i(e.target.value),disabled:o,placeholder:"Type your message…",className:"flex-1 border border-gray-300 rounded px-2 py-1"}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"bg-green-600 text-white px-4 py-1 rounded disabled:opacity-50",children:o?"…":"Send"})]})]})}function N(){let{user:e}=(0,a.A)(),t=(0,n.useRouter)(),r=(0,n.useParams)().journalTitle,i=Array.isArray(r)?r[0]:null!=r?r:"";return((0,l.useEffect)(()=>{e||t.replace("/login")},[e,t]),(0,l.useEffect)(()=>{r||t.replace("/")},[r,t]),e&&r)?(0,s.jsxs)("div",{className:"flex h-full",children:[(0,s.jsx)("aside",{className:"w-64 border-r",children:(0,s.jsx)(x,{topicId:i})}),(0,s.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,s.jsx)("header",{className:"p-4 border-b",children:(0,s.jsxs)("h1",{className:"text-xl font-semibold",children:["Studio: ",i]})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(m,{topicId:i})})]})]}):null}},4342:(e,t,r)=>{Promise.resolve().then(r.bind(r,2026))},6927:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});var s=r(5647);let l="https://cxqtrnpjshdwqtmsislw.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4cXRybnBqc2hkd3F0bXNpc2x3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTMwMDgsImV4cCI6MjA2NzM2OTAwOH0.snTMt7cMZHOdKjWMXU-TVARSp6z7wRrCGN8bVXnmAJI";if(!l||!n)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON in .env.local");let a=(0,s.UU)(l,n,{auth:{persistSession:!0,autoRefreshToken:!0}})},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>i});var s=r(5155),l=r(2115),n=r(6927);let a=(0,l.createContext)(void 0),i=e=>{let{children:t}=e,[r,i]=(0,l.useState)(null),[o,c]=(0,l.useState)(null),[u,d]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{var e;let{data:{session:t}}=await n.N.auth.getSession();c(t),i(null!=(e=null==t?void 0:t.user)?e:null),d(!1)})();let{data:e}=n.N.auth.onAuthStateChange((e,t)=>{var r;c(t),i(null!=(r=null==t?void 0:t.user)?r:null),d(!1)});return()=>{e.subscription.unsubscribe()}},[]),(0,s.jsx)(a.Provider,{value:{session:o,user:r,loading:u,signInWithEmail:(e,t)=>n.N.auth.signInWithPassword({email:e,password:t}),signOut:()=>n.N.auth.signOut()},children:t})},o=()=>{let e=(0,l.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[647,874,753,109,441,684,358],()=>t(4342)),_N_E=e.O()}]);