(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[822],{27:(e,t,r)=>{"use strict";r.d(t,{Y:()=>l,w:()=>i});var n=r(2109),s=r.n(n);let a="qKrA!A24Fn2Vd9s";if(!a)throw Error("Missing NEXT_PUBLIC_APP_ENCRYPTION in .env.local – used for client-side AES encryption");function i(e){return s().AES.encrypt(e,a).toString()}function l(e){return s().AES.decrypt(e,a).toString(s().enc.Utf8)}},477:()=>{},755:(e,t,r)=>{Promise.resolve().then(r.bind(r,2150))},2150:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(5155),s=r(2115),a=r(5695),i=r(9576),l=r(9314),o=r(6671),c=r(6927),u=r(27);async function d(e,t){let r=(0,u.w)(t),{data:n,error:s}=await c.N.from("journal_comments").insert({entry_id:e,content:r}).select("*").single();if(s)throw s;if(!n)throw Error("Failed to insert comment.");return{...n,content:(0,u.Y)(n.content)}}async function m(e){let{data:t,error:r}=await c.N.from("journal_comments").select("*").eq("entry_id",e).order("created_at",{ascending:!0});if(r)throw r;return(null!=t?t:[]).map(e=>({...e,content:(0,u.Y)(e.content)}))}function f(e){let{entryId:t}=e,{user:r}=(0,i.A)(),[a,l]=(0,s.useState)([]),[c,u]=(0,s.useState)(""),[f,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{!async function(){try{let e=await m(t);l(e)}catch(e){o.o.error("Error loading comments")}}()},[t]);let x=async e=>{if(e.preventDefault(),c.trim()){h(!0);try{let e=await d(t,c.trim());l(t=>[...t,e]),u(""),o.o.success("Comment added")}catch(e){o.o.error("Failed to add comment")}finally{h(!1)}}};return(0,n.jsxs)("div",{className:"mt-1 space-y-1",children:[a.map(e=>(0,n.jsx)("div",{className:"text-sm ".concat(e.user_id===(null==r?void 0:r.id)?"text-right text-blue-600":"text-left text-gray-700"),children:e.content},e.id)),(0,n.jsxs)("form",{onSubmit:x,className:"flex space-x-2 mt-2",children:[(0,n.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 rounded px-2 py-1 text-sm",placeholder:"Add comment...",value:c,onChange:e=>u(e.target.value),disabled:f}),(0,n.jsx)("button",{type:"submit",disabled:f||!c.trim(),className:"px-3 py-1 bg-blue-500 text-white rounded text-sm disabled:opacity-50",children:f?"…":"Reply"})]})]})}function h(){let{user:e}=(0,i.A)(),t=(0,a.useRouter)(),r=(0,a.useParams)().journalTitle,c=Array.isArray(r)?r[0]:null!=r?r:"",[u,d]=(0,s.useState)([]),[m,h]=(0,s.useState)(""),[x,p]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{e||t.replace("/login")},[e,t]),(0,s.useEffect)(()=>{r||t.replace("/")},[r,t]),(0,s.useEffect)(()=>{async function t(){try{let e=await (0,l.K)(c);d(e)}catch(e){o.o.error(e instanceof Error?e.message:"Error loading entries")}}e&&r&&t()},[e,r,c]),!e||!r)return null;let y=async e=>{if(e.preventDefault(),m.trim()){p(!0);try{let e=await (0,l.R)(c,m.trim());d(t=>[...t,e]),h(""),o.o.success("Entry added")}catch(e){o.o.error(e instanceof Error?e.message:"Failed to add entry")}finally{p(!1)}}};return(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)("header",{className:"px-4 py-2 border-b flex items-center justify-between",children:(0,n.jsxs)("h1",{className:"text-xl font-semibold",children:["Journal: ",c]})}),(0,n.jsx)("main",{className:"flex-1 overflow-auto p-4 space-y-6",children:u.map(t=>(0,n.jsxs)("div",{className:"flex flex-col space-y-2 max-w-2xl mx-auto ".concat(t.user_id===e.id?"items-end":"items-start"),children:[(0,n.jsx)("div",{className:"p-3 rounded-lg ".concat(t.user_id===e.id?"bg-blue-100 text-blue-900":"bg-gray-100 text-gray-900"),children:t.content}),(0,n.jsx)(f,{entryId:t.id})]},t.id))}),(0,n.jsx)("footer",{className:"px-4 py-2 border-t",children:(0,n.jsxs)("form",{onSubmit:y,className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"text",placeholder:"Write a new entry…",value:m,onChange:e=>h(e.target.value),disabled:x,className:"flex-1 border border-gray-300 rounded px-3 py-2"}),(0,n.jsx)("button",{type:"submit",disabled:x||!m.trim(),className:"bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50",children:x?"Saving…":"Save"})]})})]})}},6927:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var n=r(5647);let s="https://cxqtrnpjshdwqtmsislw.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4cXRybnBqc2hkd3F0bXNpc2x3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTMwMDgsImV4cCI6MjA2NzM2OTAwOH0.snTMt7cMZHOdKjWMXU-TVARSp6z7wRrCGN8bVXnmAJI";if(!s||!a)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON in .env.local");let i=(0,n.UU)(s,a,{auth:{persistSession:!0,autoRefreshToken:!0}})},9314:(e,t,r)=>{"use strict";r.d(t,{K:()=>i,R:()=>a});var n=r(6927),s=r(27);async function a(e,t){let r=(0,s.w)(t),{data:a,error:i}=await n.N.from("journal_entries").insert({topic_id:e,content:r}).select("*").single();if(i)throw i;if(!a)throw Error("Failed to insert journal entry.");return{...a,content:(0,s.Y)(a.content)}}async function i(e){let{data:t,error:r}=await n.N.from("journal_entries").select("*").eq("topic_id",e).order("created_at",{ascending:!0});if(r)throw r;return(null!=t?t:[]).map(e=>({...e,content:(0,s.Y)(e.content)}))}},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>l});var n=r(5155),s=r(2115),a=r(6927);let i=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(null);(0,s.useEffect)(()=>{a.N.auth.getSession().then(e=>{var t,r;let{data:n}=e;l(n.session),c(null!=(r=null==(t=n.session)?void 0:t.user)?r:null)});let{data:e}=a.N.auth.onAuthStateChange((e,t)=>{var r;l(t),c(null!=(r=null==t?void 0:t.user)?r:null)});return()=>{e.subscription.unsubscribe()}},[]);let u=async(e,t)=>{let{error:r}=await a.N.auth.signInWithPassword({email:e,password:t});if(r)throw r},d=async()=>{await a.N.auth.signOut(),l(null),c(null)};return(0,n.jsx)(i.Provider,{value:{user:o,session:r,signInWithEmail:u,signOut:d},children:t})}function o(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[825,671,109,441,684,358],()=>t(755)),_N_E=e.O()}]);